# Database
DATABASE_URL=postgresql://isekai:isekai@localhost:5433/isekai

# Redis
REDIS_URL=redis://localhost:6379

# Create your own OAuth app at https://www.deviantart.com/developers/apps
DEVIANTART_CLIENT_ID=your_client_id
DEVIANTART_CLIENT_SECRET=your_client_secret
DEVIANTART_REDIRECT_URI=http://localhost:4000/api/auth/deviantart/callback # Production: https://api.example.com/api/auth/deviantart/callback

# S3-Compatible Storage (MinIO, Cloudflare R2, AWS S3, etc.)
# Default: Local MinIO (works out of the box with docker compose up)
S3_ENDPOINT=http://localhost:9000
S3_REGION=us-east-1
S3_ACCESS_KEY_ID=minioadmin
S3_SECRET_ACCESS_KEY=minioadmin
S3_BUCKET_NAME=isekai-uploads
S3_PUBLIC_URL=http://localhost:9000/isekai-uploads
S3_FORCE_PATH_STYLE=true

# Session
SESSION_SECRET=change-this-to-a-random-string
ENCRYPTION_KEY=32-byte-hex-key-for-token-encryption
SESSION_STORE=redis                         # Optional: Override session storage (redis or postgres). Auto-detects if not set.
COOKIE_DOMAIN=                              # Optional: Set to ".yourdomain.com" to share cookies across subdomains in production. Leave empty for localhost.
SESSION_MAX_AGE_DAYS=7                      # Session cookie lifetime in days (default: 7)
REFRESH_TOKEN_EXPIRY_DAYS=90                # DeviantArt refresh token tracking period in days (default: 90)

# Cache Configuration (Optional - defaults provided)
CACHE_ENABLED=true                          # Master switch for Redis caching (default: true)
CACHE_DEFAULT_TTL=300                       # Default cache TTL in seconds (default: 300 = 5 minutes)
CACHE_STALE_TTL=7200                        # Stale cache TTL in seconds for 429 fallback (default: 7200 = 2 hours)

# Circuit Breaker Configuration
CIRCUIT_BREAKER_ENABLED=true                # Enable circuit breaker for rate limiting (default: true)
CIRCUIT_BREAKER_THRESHOLD=3                 # Number of 429 errors before opening circuit (default: 3)
CIRCUIT_BREAKER_OPEN_DURATION_MS=300000     # Stay open for 5 minutes (default: 300000)
CIRCUIT_BREAKER_PERSIST_TO_REDIS=true       # Persist circuit state to Redis (default: true)

# Publisher Worker Configuration
PUBLISHER_CONCURRENCY=5                     # Number of concurrent jobs per worker (default: 5)
PUBLISHER_MAX_ATTEMPTS=7                    # Max retry attempts for failed jobs (default: 7)
PUBLISHER_JOB_TIMEOUT_MS=600000             # Job timeout in milliseconds (default: 600000 = 10 min)
PUBLISHER_STALE_CHECK_INTERVAL_MS=60000     # Check for stalled jobs interval (default: 60000 = 1 min)
PUBLISHER_MAX_STALLED_COUNT=2               # Max stalled attempts before failure (default: 2)

# Rate Limiter Configuration
RATE_LIMITER_ENABLED=true                   # Enable adaptive rate limiter (default: true)
RATE_LIMITER_BASE_DELAY_MS=3000             # Base delay between requests (default: 3000 = 3 seconds)
RATE_LIMITER_MAX_DELAY_MS=300000            # Max delay between requests (default: 300000 = 5 minutes)
RATE_LIMITER_JITTER_PERCENT=20              # Jitter percentage for delays (default: 20)
RATE_LIMITER_SUCCESS_DECREASE_FACTOR=0.9    # Decrease delay after success (default: 0.9)
RATE_LIMITER_FAILURE_INCREASE_FACTOR=2.0    # Increase delay after failure (default: 2.0)

# Metrics & Monitoring
METRICS_ENABLED=true                        # Enable metrics collection (default: true)
METRICS_FLUSH_INTERVAL_MS=60000             # Flush metrics to Redis interval (default: 60000 = 1 min)
LOG_LEVEL=info                              # Log level: debug, info, warn, error (default: info)

# Frontend
FRONTEND_URL=http://localhost:3000          # Production: https://example.com

# Server
PORT=4000
NODE_ENV=development
